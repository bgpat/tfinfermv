#!/usr/bin/env bash

set -eu
# set -x

# terraform show -json plan-result
# terraform show -json plan-result > plan-result.json

jq --version
plan_file=$1

function print_specific_action_resources() {
  action_name=$1
  echo "# $action_name"
  cat $plan_file |
    jq -r \
      '.resource_changes[] |
      select(.change.actions[0] == "'$action_name'") |
      .address'
  echo ''
}

# https://github.com/hashicorp/terraform-json/blob/7bf4a174/action.go#L11-L26
print_specific_action_resources 'create'
print_specific_action_resources 'update'
print_specific_action_resources 'delete'
